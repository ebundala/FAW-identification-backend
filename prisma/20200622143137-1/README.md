# Migration `20200622143137-1`

This migration has been generated by Elias Bundala at 6/22/2020, 2:31:37 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "QuestionType" AS ENUM ('BOOLEAN', 'TEXT');

CREATE TYPE "Role" AS ENUM ('USER', 'ADMIN', 'MODERATOR', 'ORGANIZATION');

CREATE TYPE "State" AS ENUM ('PENDING', 'REVIEW', 'REJECTED', 'APPROVED', 'COMPLETED', 'ARCHIVED');

CREATE TABLE "public"."User" (
"avatorId" integer   ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"disabled" boolean  NOT NULL DEFAULT true,"displayName" text  NOT NULL ,"email" text  NOT NULL ,"emailVerified" boolean  NOT NULL DEFAULT false,"id" SERIAL,"phoneNumber" text   ,"role" "Role" NOT NULL DEFAULT E'USER',"uid" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."File" (
"answerId" integer   ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"encoding" text   ,"filename" text   ,"formId" integer   ,"gradeId" integer   ,"id" SERIAL,"mimetype" text   ,"path" text  NOT NULL ,"questionId" integer   ,"recommendationId" integer   ,"responseId" integer   ,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Form" (
"authorId" text  NOT NULL ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"description" text   ,"id" SERIAL,"state" "State" NOT NULL DEFAULT E'PENDING',"title" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Grade" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"description" text  NOT NULL ,"formId" integer  NOT NULL ,"id" SERIAL,"max" Decimal(65,30)  NOT NULL ,"maxInclusive" boolean  NOT NULL DEFAULT false,"min" Decimal(65,30)  NOT NULL ,"minInclusive" boolean  NOT NULL DEFAULT false,"name" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Response" (
"authorId" text  NOT NULL ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"formId" integer  NOT NULL ,"gradeId" integer   ,"id" SERIAL,"state" "State" NOT NULL DEFAULT E'PENDING',"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Question" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"formId" integer  NOT NULL ,"id" SERIAL,"instruction" text   ,"question" text  NOT NULL ,"questionNumber" integer  NOT NULL ,"questionType" "QuestionType" NOT NULL DEFAULT E'BOOLEAN',"updatedAt" timestamp(3)  NOT NULL ,"weight" Decimal(65,30)  NOT NULL DEFAULT 0.0,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Answer" (
"booleanValue" boolean   ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" SERIAL,"questionId" integer  NOT NULL ,"responseId" integer  NOT NULL ,"textValue" text   ,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Recommendation" (
"content" text  NOT NULL ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"gradeId" integer  NOT NULL ,"id" SERIAL,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE UNIQUE INDEX "User.uid" ON "public"."User"("uid")

CREATE UNIQUE INDEX "User.email" ON "public"."User"("email")

ALTER TABLE "public"."User" ADD FOREIGN KEY ("avatorId")REFERENCES "public"."File"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."File" ADD FOREIGN KEY ("formId")REFERENCES "public"."Form"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."File" ADD FOREIGN KEY ("gradeId")REFERENCES "public"."Grade"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."File" ADD FOREIGN KEY ("responseId")REFERENCES "public"."Response"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."File" ADD FOREIGN KEY ("questionId")REFERENCES "public"."Question"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."File" ADD FOREIGN KEY ("answerId")REFERENCES "public"."Answer"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."File" ADD FOREIGN KEY ("recommendationId")REFERENCES "public"."Recommendation"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Form" ADD FOREIGN KEY ("authorId")REFERENCES "public"."User"("uid") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Grade" ADD FOREIGN KEY ("formId")REFERENCES "public"."Form"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Response" ADD FOREIGN KEY ("authorId")REFERENCES "public"."User"("uid") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Response" ADD FOREIGN KEY ("formId")REFERENCES "public"."Form"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Response" ADD FOREIGN KEY ("gradeId")REFERENCES "public"."Grade"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Question" ADD FOREIGN KEY ("formId")REFERENCES "public"."Form"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Answer" ADD FOREIGN KEY ("responseId")REFERENCES "public"."Response"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Answer" ADD FOREIGN KEY ("questionId")REFERENCES "public"."Question"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Recommendation" ADD FOREIGN KEY ("gradeId")REFERENCES "public"."Grade"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200622143137-1
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,158 @@
+// This is your Prisma schema file,
+// learn more about it in the docs: https://pris.ly/d/prisma-schema
+
+datasource db {
+  provider = "postgresql"
+  url      = env("DATABASE_URL")
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+model User {
+  id            Int        @default(autoincrement()) @id
+  uid           String     @unique
+  email         String     @unique
+  displayName   String
+  phoneNumber   String?
+  emailVerified Boolean    @default(false)
+  disabled      Boolean    @default(true)
+  avator        File?      @relation(fields: [avatorId], references: [id])
+  avatorId      Int?
+  role          Role       @default(USER)
+  forms         Form[]
+  responses     Response[]
+  createdAt     DateTime   @default(now())
+  updatedAt     DateTime   @updatedAt
+}
+
+model File {
+  id               Int             @default(autoincrement()) @id
+  path             String
+  filename         String?
+  mimetype         String?
+  encoding         String?
+  createdAt        DateTime        @default(now())
+  updatedAt        DateTime        @updatedAt
+  User             User[]
+  Form             Form?           @relation(fields: [formId], references: [id])
+  formId           Int?
+  Grade            Grade?          @relation(fields: [gradeId], references: [id])
+  gradeId          Int?
+  Response         Response?       @relation(fields: [responseId], references: [id])
+  responseId       Int?
+  Question         Question?       @relation(fields: [questionId], references: [id])
+  questionId       Int?
+  Answer           Answer?         @relation(fields: [answerId], references: [id])
+  answerId         Int?
+  Recommendation   Recommendation? @relation(fields: [recommendationId], references: [id])
+  recommendationId Int?
+}
+
+model Form {
+  id          Int        @default(autoincrement()) @id
+  title       String
+  description String?
+  state       State      @default(PENDING)
+  author      User       @relation(fields: [authorId], references: [uid])
+  authorId    String
+  questions   Question[]
+  grades      Grade[]
+  responses   Response[]
+  attachments File[]
+  createdAt   DateTime   @default(now())
+  updatedAt   DateTime   @updatedAt
+}
+
+model Grade {
+  id              Int              @default(autoincrement()) @id
+  name            String
+  description     String
+  form            Form             @relation(fields: [formId], references: [id])
+  formId          Int
+  responses       Response[]
+  recommendations Recommendation[]
+  min             Float
+  max             Float
+  minInclusive    Boolean          @default(false)
+  maxInclusive    Boolean          @default(false)
+  attachments     File[]
+  createdAt       DateTime         @default(now())
+  updatedAt       DateTime         @updatedAt
+}
+
+model Response {
+  id          Int      @default(autoincrement()) @id
+  author      User     @relation(fields: [authorId], references: [uid])
+  authorId    String
+  form        Form     @relation(fields: [formId], references: [id])
+  formId      Int
+  answers     Answer[]
+  grade       Grade?   @relation(fields: [gradeId], references: [id])
+  gradeId     Int?
+  attachments File[]
+  state       State    @default(PENDING)
+  createdAt   DateTime @default(now())
+  updatedAt   DateTime @updatedAt
+}
+
+model Question {
+  id             Int          @default(autoincrement()) @id
+  questionNumber Int
+  question       String
+  weight         Float        @default(0.0)
+  instruction    String?
+  questionType   QuestionType @default(BOOLEAN)
+  form           Form         @relation(fields: [formId], references: [id])
+  formId         Int
+  answers        Answer[]
+  attachments    File[]
+  createdAt      DateTime     @default(now())
+  updatedAt      DateTime     @updatedAt
+}
+
+model Answer {
+  id           Int      @default(autoincrement()) @id
+  response     Response @relation(fields: [responseId], references: [id])
+  responseId   Int
+  question     Question @relation(fields: [questionId], references: [id])
+  questionId   Int
+  attachments  File[]
+  booleanValue Boolean?
+  textValue    String?
+  createdAt    DateTime @default(now())
+  updatedAt    DateTime @updatedAt
+}
+
+model Recommendation {
+  id          Int      @default(autoincrement()) @id
+  content     String
+  attachments File[]
+  grade       Grade    @relation(fields: [gradeId], references: [id])
+  gradeId     Int
+  createdAt   DateTime @default(now())
+  updatedAt   DateTime @updatedAt
+}
+
+// use boolean and text question first for POC
+enum QuestionType {
+  BOOLEAN
+  TEXT
+}
+
+enum Role {
+  USER
+  ADMIN
+  MODERATOR
+  ORGANIZATION
+}
+
+enum State {
+  PENDING
+  REVIEW
+  REJECTED
+  APPROVED
+  COMPLETED
+  ARCHIVED
+}
```


