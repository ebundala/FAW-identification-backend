# Migration `20200622180606-2`

This migration has been generated by Elias Bundala at 6/22/2020, 6:06:06 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP TABLE "public"."Answer";

DROP TABLE "public"."File";

DROP TABLE "public"."Form";

DROP TABLE "public"."Grade";

DROP TABLE "public"."Question";

DROP TABLE "public"."Recommendation";

DROP TABLE "public"."Response";

DROP TABLE "public"."User";

CREATE TYPE "QuestionType" AS ENUM ('BOOLEAN', 'TEXT');

CREATE TYPE "Role" AS ENUM ('USER', 'ADMIN', 'MODERATOR', 'ORGANIZATION');

CREATE TYPE "State" AS ENUM ('PENDING', 'REVIEW', 'REJECTED', 'APPROVED', 'COMPLETED', 'ARCHIVED');

CREATE TABLE "public"."User" (
"avatorId" text   ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"disabled" boolean  NOT NULL DEFAULT true,"displayName" text  NOT NULL ,"email" text  NOT NULL ,"emailVerified" boolean  NOT NULL DEFAULT false,"id" text  NOT NULL ,"phoneNumber" text   ,"role" "Role" NOT NULL DEFAULT E'USER',"uid" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."File" (
"answerId" text   ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"encoding" text   ,"filename" text   ,"formId" text   ,"gradeId" text   ,"id" text  NOT NULL ,"mimetype" text   ,"path" text  NOT NULL ,"questionId" text   ,"recommendationId" text   ,"responseId" text   ,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Form" (
"authorId" text  NOT NULL ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"description" text   ,"id" text  NOT NULL ,"state" "State" NOT NULL DEFAULT E'PENDING',"title" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Grade" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"description" text  NOT NULL ,"formId" text  NOT NULL ,"id" text  NOT NULL ,"max" Decimal(65,30)  NOT NULL ,"maxInclusive" boolean  NOT NULL DEFAULT false,"min" Decimal(65,30)  NOT NULL ,"minInclusive" boolean  NOT NULL DEFAULT false,"name" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Response" (
"authorId" text  NOT NULL ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"formId" text  NOT NULL ,"gradeId" text   ,"id" text  NOT NULL ,"state" "State" NOT NULL DEFAULT E'PENDING',"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Question" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"formId" text  NOT NULL ,"id" text  NOT NULL ,"instruction" text   ,"question" text  NOT NULL ,"questionNumber" integer  NOT NULL ,"questionType" "QuestionType" NOT NULL DEFAULT E'BOOLEAN',"updatedAt" timestamp(3)  NOT NULL ,"weight" Decimal(65,30)  NOT NULL DEFAULT 0.0,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Answer" (
"booleanValue" boolean   ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" text  NOT NULL ,"questionId" text  NOT NULL ,"responseId" text  NOT NULL ,"textValue" text   ,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Recommendation" (
"content" text  NOT NULL ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"gradeId" text  NOT NULL ,"id" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE UNIQUE INDEX "User.uid" ON "public"."User"("uid")

CREATE UNIQUE INDEX "User.email" ON "public"."User"("email")

ALTER TABLE "public"."User" ADD FOREIGN KEY ("avatorId")REFERENCES "public"."File"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."File" ADD FOREIGN KEY ("formId")REFERENCES "public"."Form"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."File" ADD FOREIGN KEY ("gradeId")REFERENCES "public"."Grade"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."File" ADD FOREIGN KEY ("responseId")REFERENCES "public"."Response"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."File" ADD FOREIGN KEY ("questionId")REFERENCES "public"."Question"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."File" ADD FOREIGN KEY ("answerId")REFERENCES "public"."Answer"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."File" ADD FOREIGN KEY ("recommendationId")REFERENCES "public"."Recommendation"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Form" ADD FOREIGN KEY ("authorId")REFERENCES "public"."User"("uid") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Grade" ADD FOREIGN KEY ("formId")REFERENCES "public"."Form"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Response" ADD FOREIGN KEY ("authorId")REFERENCES "public"."User"("uid") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Response" ADD FOREIGN KEY ("formId")REFERENCES "public"."Form"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Response" ADD FOREIGN KEY ("gradeId")REFERENCES "public"."Grade"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Question" ADD FOREIGN KEY ("formId")REFERENCES "public"."Form"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Answer" ADD FOREIGN KEY ("responseId")REFERENCES "public"."Response"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Answer" ADD FOREIGN KEY ("questionId")REFERENCES "public"."Question"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Recommendation" ADD FOREIGN KEY ("gradeId")REFERENCES "public"."Grade"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200622143137-1..20200622180606-2
--- datamodel.dml
+++ datamodel.dml
@@ -2,57 +2,57 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 generator client {
   provider = "prisma-client-js"
 }
 model User {
-  id            Int        @default(autoincrement()) @id
+  id            String     @default(cuid()) @id
   uid           String     @unique
   email         String     @unique
   displayName   String
   phoneNumber   String?
   emailVerified Boolean    @default(false)
   disabled      Boolean    @default(true)
   avator        File?      @relation(fields: [avatorId], references: [id])
-  avatorId      Int?
+  avatorId      String?
   role          Role       @default(USER)
   forms         Form[]
   responses     Response[]
   createdAt     DateTime   @default(now())
   updatedAt     DateTime   @updatedAt
 }
 model File {
-  id               Int             @default(autoincrement()) @id
+  id               String          @default(cuid()) @id
   path             String
   filename         String?
   mimetype         String?
   encoding         String?
   createdAt        DateTime        @default(now())
   updatedAt        DateTime        @updatedAt
   User             User[]
   Form             Form?           @relation(fields: [formId], references: [id])
-  formId           Int?
+  formId           String?
   Grade            Grade?          @relation(fields: [gradeId], references: [id])
-  gradeId          Int?
+  gradeId          String?
   Response         Response?       @relation(fields: [responseId], references: [id])
-  responseId       Int?
+  responseId       String?
   Question         Question?       @relation(fields: [questionId], references: [id])
-  questionId       Int?
+  questionId       String?
   Answer           Answer?         @relation(fields: [answerId], references: [id])
-  answerId         Int?
+  answerId         String?
   Recommendation   Recommendation? @relation(fields: [recommendationId], references: [id])
-  recommendationId Int?
+  recommendationId String?
 }
 model Form {
-  id          Int        @default(autoincrement()) @id
+  id          String     @default(cuid()) @id
   title       String
   description String?
   state       State      @default(PENDING)
   author      User       @relation(fields: [authorId], references: [uid])
@@ -65,13 +65,13 @@
   updatedAt   DateTime   @updatedAt
 }
 model Grade {
-  id              Int              @default(autoincrement()) @id
+  id              String           @default(cuid()) @id
   name            String
   description     String
   form            Form             @relation(fields: [formId], references: [id])
-  formId          Int
+  formId          String
   responses       Response[]
   recommendations Recommendation[]
   min             Float
   max             Float
@@ -82,56 +82,56 @@
   updatedAt       DateTime         @updatedAt
 }
 model Response {
-  id          Int      @default(autoincrement()) @id
+  id          String   @default(cuid()) @id
   author      User     @relation(fields: [authorId], references: [uid])
   authorId    String
   form        Form     @relation(fields: [formId], references: [id])
-  formId      Int
+  formId      String
   answers     Answer[]
   grade       Grade?   @relation(fields: [gradeId], references: [id])
-  gradeId     Int?
+  gradeId     String?
   attachments File[]
   state       State    @default(PENDING)
   createdAt   DateTime @default(now())
   updatedAt   DateTime @updatedAt
 }
 model Question {
-  id             Int          @default(autoincrement()) @id
+  id             String       @default(cuid()) @id
   questionNumber Int
   question       String
   weight         Float        @default(0.0)
   instruction    String?
   questionType   QuestionType @default(BOOLEAN)
   form           Form         @relation(fields: [formId], references: [id])
-  formId         Int
+  formId         String
   answers        Answer[]
   attachments    File[]
   createdAt      DateTime     @default(now())
   updatedAt      DateTime     @updatedAt
 }
 model Answer {
-  id           Int      @default(autoincrement()) @id
+  id           String   @default(cuid()) @id
   response     Response @relation(fields: [responseId], references: [id])
-  responseId   Int
+  responseId   String
   question     Question @relation(fields: [questionId], references: [id])
-  questionId   Int
+  questionId   String
   attachments  File[]
   booleanValue Boolean?
   textValue    String?
   createdAt    DateTime @default(now())
   updatedAt    DateTime @updatedAt
 }
 model Recommendation {
-  id          Int      @default(autoincrement()) @id
+  id          String   @default(cuid()) @id
   content     String
   attachments File[]
   grade       Grade    @relation(fields: [gradeId], references: [id])
-  gradeId     Int
+  gradeId     String
   createdAt   DateTime @default(now())
   updatedAt   DateTime @updatedAt
 }
```


