# Migration `20200623192320-3`

This migration has been generated by Elias Bundala at 6/23/2020, 7:23:20 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."Attachment" (
"answerId" text   ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"encoding" text   ,"filename" text   ,"formId" text   ,"gradeId" text   ,"id" text  NOT NULL ,"mimetype" text   ,"path" text  NOT NULL ,"questionId" text   ,"recommendationId" text   ,"responseId" text   ,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

ALTER TABLE "public"."Form" ALTER COLUMN "state" SET DEFAULT E'PENDING';

ALTER TABLE "public"."Question" ALTER COLUMN "questionType" SET DEFAULT E'BOOLEAN';

ALTER TABLE "public"."Response" ALTER COLUMN "state" SET DEFAULT E'PENDING';

ALTER TABLE "public"."User" DROP CONSTRAINT IF EXiSTS "User_avatorId_fkey",
ALTER COLUMN "role" SET DEFAULT E'USER';

ALTER TABLE "public"."File" DROP CONSTRAINT IF EXiSTS "File_answerId_fkey";

ALTER TABLE "public"."File" DROP CONSTRAINT IF EXiSTS "File_formId_fkey";

ALTER TABLE "public"."File" DROP CONSTRAINT IF EXiSTS "File_gradeId_fkey";

ALTER TABLE "public"."File" DROP CONSTRAINT IF EXiSTS "File_questionId_fkey";

ALTER TABLE "public"."File" DROP CONSTRAINT IF EXiSTS "File_recommendationId_fkey";

ALTER TABLE "public"."File" DROP CONSTRAINT IF EXiSTS "File_responseId_fkey";

ALTER TABLE "public"."Attachment" ADD FOREIGN KEY ("formId")REFERENCES "public"."Form"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Attachment" ADD FOREIGN KEY ("gradeId")REFERENCES "public"."Grade"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Attachment" ADD FOREIGN KEY ("responseId")REFERENCES "public"."Response"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Attachment" ADD FOREIGN KEY ("questionId")REFERENCES "public"."Question"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Attachment" ADD FOREIGN KEY ("answerId")REFERENCES "public"."Answer"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Attachment" ADD FOREIGN KEY ("recommendationId")REFERENCES "public"."Recommendation"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."User" ADD FOREIGN KEY ("avatorId")REFERENCES "public"."Attachment"("id") ON DELETE SET NULL  ON UPDATE CASCADE

DROP TABLE "public"."File";
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200622183353-1..20200623192320-3
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 generator client {
   provider = "prisma-client-js"
@@ -16,18 +16,18 @@
   displayName   String
   phoneNumber   String?
   emailVerified Boolean    @default(false)
   disabled      Boolean    @default(true)
-  avator        File?      @relation(fields: [avatorId], references: [id])
+  avator        Attachment?      @relation(fields: [avatorId], references: [id])
   avatorId      String?
   role          Role       @default(USER)
   forms         Form[]
   responses     Response[]
   createdAt     DateTime   @default(now())
   updatedAt     DateTime   @updatedAt
 }
-model File {
+model Attachment {
   id               String          @default(cuid()) @id
   path             String
   filename         String?
   mimetype         String?
@@ -58,9 +58,9 @@
   authorId    String
   questions   Question[]
   grades      Grade[]
   responses   Response[]
-  attachments File[]
+  attachments Attachment[]
   createdAt   DateTime   @default(now())
   updatedAt   DateTime   @updatedAt
 }
@@ -75,9 +75,9 @@
   min             Float
   max             Float
   minInclusive    Boolean          @default(false)
   maxInclusive    Boolean          @default(false)
-  attachments     File[]
+  attachments     Attachment[]
   createdAt       DateTime         @default(now())
   updatedAt       DateTime         @updatedAt
 }
@@ -89,9 +89,9 @@
   formId      String
   answers     Answer[]
   grade       Grade?   @relation(fields: [gradeId], references: [id])
   gradeId     String?
-  attachments File[]
+  attachments Attachment[]
   state       State    @default(PENDING)
   createdAt   DateTime @default(now())
   updatedAt   DateTime @updatedAt
 }
@@ -105,9 +105,9 @@
   questionType   QuestionType @default(BOOLEAN)
   form           Form         @relation(fields: [formId], references: [id])
   formId         String
   answers        Answer[]
-  attachments    File[]
+  attachments    Attachment[]
   createdAt      DateTime     @default(now())
   updatedAt      DateTime     @updatedAt
 }
@@ -116,9 +116,9 @@
   response     Response @relation(fields: [responseId], references: [id])
   responseId   String
   question     Question @relation(fields: [questionId], references: [id])
   questionId   String
-  attachments  File[]
+  attachments  Attachment[]
   booleanValue Boolean?
   textValue    String?
   createdAt    DateTime @default(now())
   updatedAt    DateTime @updatedAt
@@ -126,9 +126,9 @@
 model Recommendation {
   id          String   @default(cuid()) @id
   content     String
-  attachments File[]
+  attachments Attachment[]
   grade       Grade    @relation(fields: [gradeId], references: [id])
   gradeId     String
   createdAt   DateTime @default(now())
   updatedAt   DateTime @updatedAt
```


